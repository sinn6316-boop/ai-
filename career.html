<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>직업 적성 테스트 - AI 심리분석</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/poomang-style.css">
        <!-- CSS -->
    <link rel="stylesheet" href="assets/css/new-style.css">
    <link rel="stylesheet" href="assets/css/new-navigation.css">
    
    <!-- 아이콘 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 폰트 -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- Paperozi 폰트는 CSS 파일에서 @font-face로 로드됩니다 -->
    

</head>
<body class="career-theme">
    <!-- 네비게이션 -->
    <nav class="navbar">
        <div class="nav-container">
            <!-- 로고 -->
            <div class="nav-logo">
                <a href="index.html">
                    <i class="fas fa-brain"></i>
                    <span>AI 심리분석</span>
                </a>
            </div>

            <!-- 메뉴 토글 버튼 (모바일) -->
            <button class="nav-toggle" type="button">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>

            <!-- 네비게이션 메뉴 -->
            <div class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>홈</span>
                </a>
                <a href="personality.html" class="nav-link">
                    <i class="fas fa-user"></i>
                    <span>성격 유형</span>
                </a>
                <a href="love.html" class="nav-link">
                    <i class="fas fa-heart"></i>
                    <span>연애 스타일</span>
                </a>
                <a href="career.html" class="nav-link active">
                    <i class="fas fa-briefcase"></i>
                    <span>직업 적성</span>
                </a>
                <a href="stress.html" class="nav-link">
                    <i class="fas fa-spa"></i>
                    <span>스트레스 진단</span>
                </a>
                <a href="leadership.html" class="nav-link">
                    <i class="fas fa-crown"></i>
                    <span>리더십 유형</span>
                </a>
                <a href="teto-test.html" class="nav-link">
                    <i class="fas fa-balance-scale"></i>
                    <span>테토 유형</span>
                </a>
            </div>

            <!-- 모바일 드롭다운 메뉴 -->
            <div class="nav-dropdown">
                <a href="index.html" class="nav-dropdown-item">
                    <i class="fas fa-home"></i>
                    <span>홈</span>
                </a>
                <a href="personality.html" class="nav-dropdown-item">
                    <i class="fas fa-user"></i>
                    <span>성격 유형</span>
                </a>
                <a href="love.html" class="nav-dropdown-item">
                    <i class="fas fa-heart"></i>
                    <span>연애 스타일</span>
                </a>
                <a href="career.html" class="nav-dropdown-item active">
                    <i class="fas fa-briefcase"></i>
                    <span>직업 적성</span>
                </a>
                <a href="stress.html" class="nav-dropdown-item">
                    <i class="fas fa-spa"></i>
                    <span>스트레스 진단</span>
                </a>
                <a href="leadership.html" class="nav-dropdown-item">
                    <i class="fas fa-crown"></i>
                    <span>리더십 유형</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- 메인 컨텐츠 -->
    <main class="main-content">
        <!-- 테스트 인트로 섹션 -->
        <section id="test-intro" class="test-intro">
            <div class="container">
                <div class="intro-content">
                    <div class="intro-icon">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <h1 class="intro-title">직업 적성 테스트</h1>
                    <p class="intro-subtitle">나에게 맞는 직업과 진로 방향 찾기</p>
                    <p class="intro-description">
                        18개의 직업 관련 상황 질문을 통해 당신에게 가장 적합한 직업군을 분석합니다.<br>
                        성향, 가치관, 능력, 환경 선호도 등을 종합적으로 고려하여<br>
                        당신만의 커리어 방향을 제시해드립니다.
                    </p>
                    
                    <div class="test-info">
                        <div class="info-item">
                            <i class="fas fa-clock"></i>
                            <span>소요시간: 3-4분</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-question-circle"></i>
                            <span>문항수: 18개</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-users"></i>
                            <span>1.8만명 참여</span>
                        </div>
                    </div>

                    <button class="start-test-btn" onclick="startCareerTest()">
                        <i class="fas fa-play"></i>
                        <span>테스트 시작하기</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- 테스트 진행 섹션 -->
        <section id="test-section" class="test-section" style="display: none;">
            <div class="test-container">
                <!-- 진행바 -->
                <div class="test-header">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <span class="progress-text" id="progress-text">1 / 18</span>
                    </div>
                    <button class="home-btn" onclick="goHome()">
                        <i class="fas fa-home"></i>
                    </button>
                </div>

                <!-- 질문 영역 -->
                <div class="question-container">
                    <div class="question-card" id="question-card">
                        <div class="question-number" id="question-number">Q1</div>
                        <h2 class="question-title" id="question-title">질문이 여기에 표시됩니다</h2>
                        <div class="question-image" id="question-image">
                            <i class="fas fa-briefcase"></i>
                        </div>
                    </div>

                    <div class="answers-container" id="answers-container">
                        <!-- 답변 옵션들이 동적으로 생성됩니다 -->
                    </div>
                </div>
            </div>
        </section>

        <!-- 결과 섹션 -->
        <section id="result-section" class="result-section" style="display: none;">
            <div class="result-container">
                <!-- 메인 결과 -->
                <div class="result-main">
                    <div class="result-card" id="result-card">
                        <div class="result-icon" id="result-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <h2 class="result-title" id="result-title">당신에게 적합한 직업</h2>
                        <div class="result-career-type" id="result-career-type">창조형</div>
                        <h3 class="result-type" id="result-type">크리에이티브 전문가</h3>
                        <p class="result-description" id="result-description">
                            결과 설명이 여기에 표시됩니다.
                        </p>
                        
                        <div class="result-stats" id="result-stats">
                            <!-- 직업 적성별 점수가 동적으로 생성됩니다 -->
                        </div>
                    </div>

                    <!-- 공유 버튼들 -->
                    <div class="share-buttons">
                        <button class="share-btn share-capture" onclick="captureResult()">
                            <i class="fas fa-camera"></i>
                            <span>결과 캡처</span>
                        </button>
                        <button class="share-btn share-copy" onclick="copyResult()">
                            <i class="fas fa-copy"></i>
                            <span>링크복사</span>
                        </button>
                    </div>
                </div>

                <!-- 추천 직업 -->
                <div class="recommended-jobs">
                    <h3><i class="fas fa-star"></i> 추천 직업군</h3>
                    <div class="jobs-grid" id="jobs-grid">
                        <!-- 추천 직업들이 동적으로 생성됩니다 -->
                    </div>
                </div>

                <!-- 커리어 조언 -->
                <div class="career-advice">
                    <h3><i class="fas fa-lightbulb"></i> 커리어 성공 전략</h3>
                    <div class="advice-card" id="career-advice-card">
                        <p id="career-advice-text">당신만의 커리어 조언이 여기에 표시됩니다.</p>
                    </div>
                </div>

                <!-- 발전 방향 -->
                <div class="development-areas">
                    <h3><i class="fas fa-chart-line"></i> 발전해야 할 역량</h3>
                    <div class="skills-grid" id="skills-grid">
                        <!-- 필요 스킬들이 동적으로 생성됩니다 -->
                    </div>
                </div>

                <!-- 다른 테스트 추천 -->
                <div class="recommended-tests">
                    <h3><i class="fas fa-magic"></i> 다른 테스트도 해보세요!</h3>
                    <div class="tests-grid">
                        <div class="test-item" onclick="location.href='personality.html'">
                            <i class="fas fa-user"></i>
                            <h4>성격 유형 테스트</h4>
                            <p>MBTI 기반 성격 분석</p>
                        </div>
                        <div class="test-item" onclick="location.href='love.html'">
                            <i class="fas fa-heart"></i>
                            <h4>연애 스타일 테스트</h4>
                            <p>나의 연애 패턴 분석</p>
                        </div>
                        <div class="test-item" onclick="location.href='stress.html'">
                            <i class="fas fa-spa"></i>
                            <h4>스트레스 진단</h4>
                            <p>스트레스 해소법 제안</p>
                        </div>
                        <div class="test-item" onclick="location.href='leadership.html'">
                            <i class="fas fa-crown"></i>
                            <h4>리더십 유형</h4>
                            <p>나의 리더십 스타일</p>
                        </div>
                    </div>
                </div>

                <!-- 다시 테스트하기 -->
                <div class="restart-section">
                    <button class="restart-btn" onclick="restartTest()">
                        <i class="fas fa-redo"></i>
                        <span>다시 테스트하기</span>
                    </button>
                    <button class="home-btn-result" onclick="location.href='index.html'">
                        <i class="fas fa-home"></i>
                        <span>홈으로 가기</span>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- 로딩 화면 -->
    <div id="loading" class="loading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>직업 적성을 분석중...</p>
    </div>

    <!-- 토스트 메시지 -->
    <div id="toast" class="toast">
        <span id="toast-message"></span>
    </div>

    <!-- JavaScript -->
    <script src="assets/js/navigation.js"></script>
    <script src="assets/js/career-data.js"></script>
    <script src="assets/js/career-test.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/share-utils.js"></script>
    <script src="assets/js/test-utils.js"></script>
    
    <!-- 전역 변수 안전 할당 -->
    <script>
        if (typeof careerQuestions !== 'undefined') {
            window.careerQuestions = careerQuestions;
        }
        if (typeof CareerTest !== 'undefined') {
            window.CareerTest = CareerTest;
        }
    </script>
    
    <script>
        // 전역 변수
        let careerTestInstance = null;

        // 캡처 함수
        function captureResult() {
            console.log('결과 캡처 시작');
            
            // 결과 영역 확인
            const resultContainer = document.getElementById('result');
            if (!resultContainer || resultContainer.style.display === 'none') {
                showToast('결과가 표시되지 않았습니다. 테스트를 먼저 완료해주세요.');
                return;
            }

            // HTML2Canvas 라이브러리 동적 로딩
            if (typeof html2canvas === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                script.onload = () => {
                    setTimeout(() => performCapture(resultContainer), 100);
                };
                script.onerror = () => {
                    console.error('HTML2Canvas 로딩 실패');
                    fallbackCapture();
                };
                document.head.appendChild(script);
            } else {
                performCapture(resultContainer);
            }
        }

        function performCapture(element) {
            html2canvas(element, {
                backgroundColor: '#f8f9fa',
                scale: 2,
                logging: false,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                try {
                    // 캔버스를 이미지로 변환
                    const link = document.createElement('a');
                    link.download = `career-test-result-${new Date().getTime()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    
                    // 자동 다운로드
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showToast('결과가 이미지로 저장되었습니다!');
                } catch (error) {
                    console.error('이미지 저장 오류:', error);
                    fallbackCapture();
                }
            }).catch(error => {
                console.error('캡처 오류:', error);
                fallbackCapture();
            });
        }

        function fallbackCapture() {
            // 폴백: 결과 텍스트 복사
            const resultData = localStorage.getItem('careerTestResult');
            if (resultData) {
                const result = JSON.parse(resultData);
                const textToCopy = `나의 직업 적성 테스트 결과
                
유형: ${result.name}
설명: ${result.description}
특징: ${result.traits?.join(', ') || ''}
추천 직업: ${result.careers?.join(', ') || ''}

테스트 링크: ${window.location.href}`;
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showToast('결과가 클립보드에 복사되었습니다!');
                    }).catch(() => {
                        copyToClipboardFallback(textToCopy);
                    });
                } else {
                    copyToClipboardFallback(textToCopy);
                }
            } else {
                showToast('저장할 결과가 없습니다.');
            }
        }

        function copyToClipboardFallback(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('결과가 클립보드에 복사되었습니다!');
            } catch (err) {
                console.error('복사 실패:', err);
                showToast('복사에 실패했습니다.');
            }
            document.body.removeChild(textArea);
        }
            }
            
            console.log('결과 데이터 확인됨:', resultData);
            const result = JSON.parse(resultData);
            const currentUrl = window.location.href;
            
            // 카카오톡 SDK 상태 확인
            if (typeof Kakao === 'undefined' || !Kakao.isInitialized()) {
                console.error('Kakao SDK가 준비되지 않았습니다.');
                showToast('카카오톡 공유 기능을 사용할 수 없습니다. 링크를 복사합니다.');
                copyResult();
                return;
            }
            
            console.log('카카오톡 SDK 상태 정상, 공유 시작');
            
            try {
                Kakao.Share.sendDefault({
                    objectType: 'feed',
                    content: {
                        title: `나의 직업 적성은 "${result.name}"!`,
                        description: `${result.description ? result.description.substring(0, 50) + '...' : '직업 적성 테스트 결과를 확인해보세요!'}`,
                        imageUrl: `https://via.placeholder.com/500x400/4169E1/FFFFFF?text=${result.type || '직업적성'}`,
                        link: {
                            mobileWebUrl: currentUrl,
                            webUrl: currentUrl,
                        },
                    },
                    buttons: [
                        {
                            title: '나도 테스트 하기',
                            link: {
                                mobileWebUrl: currentUrl,
                                webUrl: currentUrl,
                            },
                        },
                    ],
                });
                console.log('카카오톡 공유 성공');
                showToast('카카오톡 공유 완료!');
            } catch (error) {
                console.error('카카오톡 공유 오류:', error);
                showToast('카카오톡 공유에 실패했습니다. 링크를 복사합니다.');
                copyResult();
            }
        }

        
        function copyResult() {
            const currentUrl = window.location.href;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(currentUrl).then(() => {
                    showToast('링크가 복사되었습니다!');
                }).catch(() => {
                    fallbackCopyTextToClipboard(currentUrl);
                });
            } else {
                fallbackCopyTextToClipboard(currentUrl);
            }
        }
        
        // 링크 복사 대체 함수
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showToast('링크가 복사되었습니다!');
            } catch (err) {
                showToast('링크 복사에 실패했습니다.');
            }
            
            document.body.removeChild(textArea);
        }
        
        // 토스트 메시지 표시 함수
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            if (toast && toastMessage) {
                toastMessage.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // 전역 함수: 직업 적성 테스트 시작
        function startCareerTest() {
            console.log('startCareerTest 함수 호출됨');
            
            // 인스턴스가 없으면 생성
            if (!careerTestInstance) {
                if (typeof CareerTest !== 'undefined') {
                    careerTestInstance = new CareerTest();
                    console.log('CareerTest 인스턴스 새로 생성됨');
                } else {
                    console.error('CareerTest 클래스를 찾을 수 없습니다');
                    return;
                }
            }
            
            if (careerTestInstance && typeof careerTestInstance.startTest === 'function') {
                console.log('careerTestInstance 존재함, startTest 호출');
                careerTestInstance.startTest();
            } else {
                console.error('startTest 메소드를 찾을 수 없습니다');
            }
        }

        // DOM 로드 완료 후 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로드 완료');
            
            // JavaScript 파일들이 로드될 때까지 약간 대기
            setTimeout(() => {
                console.log('CareerTest 타입 체크:', typeof CareerTest);
                console.log('careerQuestions 타입 체크:', typeof careerQuestions);
                
                if (typeof CareerTest !== 'undefined') {
                    try {
                        careerTestInstance = new CareerTest();
                        window.careerTestInstance = careerTestInstance;
                        console.log('CareerTest 인스턴스 생성됨');
                    } catch (error) {
                        console.error('CareerTest 인스턴스 생성 실패:', error);
                    }
                } else {
                    console.error('CareerTest 클래스를 찾을 수 없습니다');
                }
            }, 200);
        });
    </script>
</body>
</html>